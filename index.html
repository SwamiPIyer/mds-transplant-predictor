<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MDS Allogeneic Transplant Risk Predictor</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: #333; 
            line-height: 1.6; 
        }
        
        .app-container { 
            min-height: 100vh; 
            background: white; 
            margin: 0 auto; 
            max-width: 1600px; 
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1); 
        }
        
        .main-header { 
            background: linear-gradient(135deg, #2c3e50, #e74c3c); 
            color: white; 
            padding: 30px; 
            text-align: center; 
        }
        
        .main-header h1 { 
            font-size: 2.5em; 
            margin-bottom: 10px; 
        }
        
        .main-content { 
            padding: 30px; 
            display: flex; 
            flex-direction: column; 
            gap: 30px; 
        }
        
        section { 
            background: #f8f9fa; 
            border-radius: 15px; 
            padding: 30px; 
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); 
        }
        
        section h2 { 
            color: #2c3e50; 
            margin-bottom: 25px; 
            font-size: 1.8em; 
            border-bottom: 3px solid #e74c3c; 
            padding-bottom: 10px; 
        }
        
        .info-grid, .donor-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); 
            gap: 25px; 
        }
        
        .info-group, .donor-group { 
            background: white; 
            padding: 25px; 
            border-radius: 10px; 
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05); 
        }
        
        .info-group h3, .donor-group h3 { 
            color: #34495e; 
            margin-bottom: 20px; 
            font-size: 1.3em; 
            border-left: 4px solid #e74c3c; 
            padding-left: 15px; 
        }
        
        .form-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 20px; 
        }
        
        .form-group { 
            display: flex; 
            flex-direction: column; 
        }
        
        .form-group label { 
            font-weight: 600; 
            margin-bottom: 8px; 
            color: #555; 
        }
        
        .form-group input, .form-group select { 
            padding: 12px; 
            border: 2px solid #ddd; 
            border-radius: 8px; 
            font-size: 14px; 
            transition: border-color 0.3s ease; 
        }
        
        .form-group input:focus, .form-group select:focus { 
            outline: none; 
            border-color: #e74c3c; 
        }
        
        .form-group small { 
            color: #666; 
            font-size: 12px; 
            margin-top: 5px; 
        }

        .form-group input.valid { border-color: #27ae60; }
        .form-group input.invalid { border-color: #e74c3c; }
        
        .validation-message {
            color: #e74c3c;
            font-size: 12px;
            margin-top: 5px;
        }
        
        .primary-btn { 
            background: #e74c3c; 
            color: white; 
            border: none; 
            padding: 12px 24px; 
            border-radius: 8px; 
            cursor: pointer; 
            font-weight: 600; 
            transition: all 0.3s ease; 
        }
        
        .primary-btn:hover { 
            background: #c0392b; 
            transform: translateY(-2px); 
        }
        
        .secondary-btn { 
            background: #95a5a6; 
            color: white; 
            border: none; 
            padding: 12px 24px; 
            border-radius: 8px; 
            cursor: pointer; 
            font-weight: 600; 
            transition: all 0.3s ease; 
        }
        
        .secondary-btn:hover { 
            background: #7f8c8d; 
            transform: translateY(-2px); 
        }
        
        .assessment-controls { 
            display: flex; 
            gap: 15px; 
            margin-bottom: 25px; 
            flex-wrap: wrap; 
        }
        
        .results-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); 
            gap: 25px; 
            margin-bottom: 30px; 
        }
        
        .risk-scores-card, .outcomes-card, .recommendations-card { 
            background: white; 
            padding: 25px; 
            border-radius: 10px; 
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1); 
        }
        
        .risk-scores-card h3, .outcomes-card h3, .recommendations-card h3 { 
            color: #2c3e50; 
            margin-bottom: 20px; 
            font-size: 1.4em; 
            border-bottom: 2px solid #e74c3c; 
            padding-bottom: 10px; 
        }
        
        .scores-list, .outcomes-list { 
            display: flex; 
            flex-direction: column; 
            gap: 15px; 
        }
        
        .score-item, .outcome-item { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 15px; 
            background: #f8f9fa; 
            border-radius: 8px; 
            border-left: 4px solid #e74c3c; 
        }
        
        .score-label, .outcome-label { 
            font-weight: 600; 
            color: #555; 
            flex: 1; 
        }
        
        .score-value, .outcome-value { 
            font-weight: bold; 
            color: #2c3e50; 
            font-size: 1.2em; 
            margin: 0 10px; 
        }
        
        .score-risk { 
            background: #ecf0f1; 
            color: #2c3e50; 
            padding: 4px 8px; 
            border-radius: 4px; 
            font-size: 12px; 
            font-weight: 600; 
        }
        
        .score-risk.low { background: #d5f4e6; color: #27ae60; }
        .score-risk.intermediate { background: #ffeaa7; color: #f39c12; }
        .score-risk.high { background: #fab1a0; color: #e17055; }
        .score-risk.very-high { background: #ff7675; color: #d63031; }
        .score-risk.very-low { background: #a8e6cf; color: #27ae60; }
        
        .confidence-interval { 
            font-size: 12px; 
            color: #666; 
            font-style: italic; 
        }
        
        .recommendations-list { 
            display: flex; 
            flex-direction: column; 
            gap: 12px; 
        }
        
        .recommendation-item { 
            padding: 12px; 
            border-radius: 6px; 
            border-left: 4px solid #e74c3c; 
        }
        
        .recommendation-item.high-priority { 
            background: #fff5f5; 
            border-left-color: #e53e3e; 
        }
        
        .recommendation-item.medium-priority { 
            background: #fffbf0; 
            border-left-color: #dd6b20; 
        }
        
        .recommendation-item.low-priority { 
            background: #f0fff4; 
            border-left-color: #38a169; 
        }
        
        .charts-section { 
            margin-top: 30px; 
        }
        
        .charts-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); 
            gap: 25px; 
            margin-top: 20px; 
        }
        
        .chart-container { 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1); 
            height: 400px; 
        }

        .message {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 500;
        }

        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .message.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }
        
        @media (max-width: 768px) {
            .main-content { padding: 15px; }
            .info-grid, .donor-grid { grid-template-columns: 1fr; }
            .form-grid { grid-template-columns: 1fr; }
            .results-grid { grid-template-columns: 1fr; }
            .charts-grid { grid-template-columns: 1fr; }
            .assessment-controls { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="main-header">
            <h1>üè• MDS Allogeneic Transplant Risk Predictor</h1>
            <p>Evidence-based outcome prediction for myelodysplastic syndrome patients</p>
        </header>

        <div class="main-content">
            <div id="messageContainer"></div>

            <!-- Patient Information Section -->
            <section class="patient-info-section">
                <h2>üë§ Patient Characteristics</h2>
                
                <div class="info-grid">
                    <div class="info-group">
                        <h3>Demographics</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="patientAge">Age (years):</label>
                                <input type="number" id="patientAge" min="18" max="80" required>
                                <small>Higher age increases transplant-related mortality</small>
                            </div>
                            <div class="form-group">
                                <label for="patientGender">Gender:</label>
                                <select id="patientGender" required>
                                    <option value="">Select Gender</option>
                                    <option value="male">Male</option>
                                    <option value="female">Female</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="performanceStatus">Performance Status (ECOG):</label>
                                <select id="performanceStatus" required>
                                    <option value="">Select Status</option>
                                    <option value="0">0 - Fully active</option>
                                    <option value="1">1 - Restricted in strenuous activity</option>
                                    <option value="2">2 - Ambulatory, up >50% of time</option>
                                    <option value="3">3 - Limited self-care, up <50% of time</option>
                                    <option value="4">4 - Completely disabled</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="hctCi">HCT-CI Score:</label>
                                <select id="hctCi" required>
                                    <option value="">Select Score</option>
                                    <option value="0">0 - No comorbidities</option>
                                    <option value="1-2">1-2 - Mild comorbidities</option>
                                    <option value="3-4">3-4 - Moderate comorbidities</option>
                                    <option value="5+">‚â•5 - Severe comorbidities</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="info-group">
                        <h3>Disease Characteristics</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="mdsSubtype">MDS Subtype (WHO 2016):</label>
                                <select id="mdsSubtype" required>
                                    <option value="">Select Subtype</option>
                                    <option value="mds-sld">MDS-SLD (Single lineage dysplasia)</option>
                                    <option value="mds-mld">MDS-MLD (Multilineage dysplasia)</option>
                                    <option value="mds-rs-sld">MDS-RS-SLD (Ring sideroblasts, single lineage)</option>
                                    <option value="mds-rs-mld">MDS-RS-MLD (Ring sideroblasts, multilineage)</option>
                                    <option value="mds-eb1">MDS-EB-1 (Excess blasts-1, 5-9%)</option>
                                    <option value="mds-eb2">MDS-EB-2 (Excess blasts-2, 10-19%)</option>
                                    <option value="mds-u">MDS-U (Unclassifiable)</option>
                                    <option value="mds-del5q">MDS with isolated del(5q)</option>
                                    <option value="therapy-related">Therapy-related MDS</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="blastPercentage">Bone Marrow Blasts (%):</label>
                                <input type="number" id="blastPercentage" min="0" max="30" step="0.1" required>
                                <small>Percentage of blasts in bone marrow</small>
                            </div>
                            <div class="form-group">
                                <label for="cytogenetics">Cytogenetic Risk (IPSS-R):</label>
                                <select id="cytogenetics" required>
                                    <option value="">Select Risk</option>
                                    <option value="very-good">Very Good (-Y, del(11q))</option>
                                    <option value="good">Good (Normal, del(5q), del(12p), del(20q), double including del(5q))</option>
                                    <option value="intermediate">Intermediate (del(7q), +8, +19, i(17q), any other single or double independent clones)</option>
                                    <option value="poor">Poor (-7, inv(3)/t(3q)/del(3q), double including -7/del(7q), complex: 3 abnormalities)</option>
                                    <option value="very-poor">Very Poor (Complex: >3 abnormalities)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="ipssrScore">IPSS-R Score:</label>
                                <input type="number" id="ipssrScore" min="0" max="10" step="0.5">
                                <small>Revised International Prognostic Scoring System</small>
                            </div>
                        </div>
                    </div>

                    <div class="info-group">
                        <h3>Laboratory Parameters</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="hemoglobin">Hemoglobin (g/dL):</label>
                                <input type="number" id="hemoglobin" min="4" max="18" step="0.1" required>
                            </div>
                            <div class="form-group">
                                <label for="platelets">Platelets (√ó10¬≥/ŒºL):</label>
                                <input type="number" id="platelets" min="5" max="1000" required>
                            </div>
                            <div class="form-group">
                                <label for="anc">ANC (√ó10¬≥/ŒºL):</label>
                                <input type="number" id="anc" min="0.1" max="50" step="0.1" required>
                                <small>Absolute Neutrophil Count</small>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Donor and Treatment Section -->
            <section class="donor-treatment-section">
                <h2>ü©∏ Donor and Treatment Characteristics</h2>
                
                <div class="donor-grid">
                    <div class="donor-group">
                        <h3>Donor Selection</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="donorType">Donor Type:</label>
                                <select id="donorType" required>
                                    <option value="">Select Donor Type</option>
                                    <option value="sibling">HLA-matched sibling</option>
                                    <option value="mud">Matched unrelated donor (MUD)</option>
                                    <option value="mmud">Mismatched unrelated donor (MMUD)</option>
                                    <option value="haplo">Haploidentical</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="hlaMatching">HLA Matching:</label>
                                <select id="hlaMatching" required>
                                    <option value="">Select Matching</option>
                                    <option value="10/10">10/10 (HLA-A, B, C, DRB1, DQB1)</option>
                                    <option value="9/10">9/10 (Single antigen mismatch)</option>
                                    <option value="8/10">8/10 (Single allele mismatch)</option>
                                    <option value="7/10">7/10 (Two mismatches)</option>
                                    <option value="haplo">Haploidentical (‚â§6/10)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="donor-group">
                        <h3>Transplant Protocol</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="conditioningIntensity">Conditioning Intensity:</label>
                                <select id="conditioningIntensity" required>
                                    <option value="">Select Intensity</option>
                                    <option value="mac">Myeloablative (MAC)</option>
                                    <option value="ric">Reduced Intensity (RIC)</option>
                                    <option value="nma">Non-myeloablative (NMA)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="conditioningRegimen">Conditioning Regimen:</label>
                                <select id="conditioningRegimen" required>
                                    <option value="">Select Regimen</option>
                                    <option value="bu-cy">Busulfan + Cyclophosphamide</option>
                                    <option value="bu-flu">Busulfan + Fludarabine</option>
                                    <option value="cy-tbi">Cyclophosphamide + TBI</option>
                                    <option value="flu-bu">Fludarabine + Busulfan (RIC)</option>
                                    <option value="flu-mel">Fludarabine + Melphalan</option>
                                    <option value="flu-cy-tbi">Fludarabine + Cyclophosphamide + TBI (NMA)</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="gvhdProphylaxis">GVHD Prophylaxis:</label>
                                <select id="gvhdProphylaxis" required>
                                    <option value="">Select Prophylaxis</option>
                                    <option value="csa-mtx">Cyclosporine + Methotrexate</option>
                                    <option value="tacro-mtx">Tacrolimus + Methotrexate</option>
                                    <option value="tacro-mmf">Tacrolimus + MMF</option>
                                    <option value="ptcy">Post-transplant Cyclophosphamide</option>
                                    <option value="ptcy-tacro-mmf">PTCy + Tacrolimus + MMF</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="stemCellSource">Stem Cell Source:</label>
                                <select id="stemCellSource" required>
                                    <option value="">Select Source</option>
                                    <option value="pbsc">Peripheral Blood (PBSC)</option>
                                    <option value="bm">Bone Marrow</option>
                                    <option value="cb">Cord Blood</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Risk Assessment Results -->
            <section class="risk-assessment-section">
                <h2>üìä Risk Assessment & Outcomes Prediction</h2>
                
                <div class="assessment-controls">
                    <button id="calculateRisk" class="primary-btn">Calculate Risk Scores</button>
                    <button id="compareScenarios" class="secondary-btn">Compare Donor Types</button>
                    <button id="exportReport" class="secondary-btn">Export Report</button>
                </div>

                <div class="results-grid">
                    <div class="risk-scores-card">
                        <h3>Risk Scores</h3>
                        <div class="scores-list">
                            <div class="score-item">
                                <span class="score-label">HCT-CI Score:</span>
                                <span id="hctCiResult" class="score-value">-</span>
                                <span id="hctCiRisk" class="score-risk">-</span>
                            </div>
                            <div class="score-item">
                                <span class="score-label">IPSS-R Risk:</span>
                                <span id="ipssrResult" class="score-value">-</span>
                                <span id="ipssrRisk" class="score-risk">-</span>
                            </div>
                            <div class="score-item">
                                <span class="score-label">Disease Risk Index:</span>
                                <span id="driResult" class="score-value">-</span>
                                <span id="driRisk" class="score-risk">-</span>
                            </div>
                            <div class="score-item">
                                <span class="score-label">Transplant Risk Index:</span>
                                <span id="triResult" class="score-value">-</span>
                                <span id="triRisk" class="score-risk">-</span>
                            </div>
                        </div>
                    </div>

                    <div class="outcomes-card">
                        <h3>Predicted Outcomes (2-year)</h3>
                        <div class="outcomes-list">
                            <div class="outcome-item">
                                <span class="outcome-label">Overall Survival:</span>
                                <span id="osResult" class="outcome-value">-</span>
                                <div class="confidence-interval" id="osCI">-</div>
                            </div>
                            <div class="outcome-item">
                                <span class="outcome-label">Disease-Free Survival:</span>
                                <span id="dfsResult" class="outcome-value">-</span>
                                <div class="confidence-interval" id="dfsCI">-</div>
                            </div>
                            <div class="outcome-item">
                                <span class="outcome-label">Non-Relapse Mortality:</span>
                                <span id="nrmResult" class="outcome-value">-</span>
                                <div class="confidence-interval" id="nrmCI">-</div>
                            </div>
                            <div class="outcome-item">
                                <span class="outcome-label">Relapse Rate:</span>
                                <span id="relapseResult" class="outcome-value">-</span>
                                <div class="confidence-interval" id="relapseCI">-</div>
                            </div>
                            <div class="outcome-item">
                                <span class="outcome-label">Acute GVHD (II-IV):</span>
                                <span id="aGvhdResult" class="outcome-value">-</span>
                                <div class="confidence-interval" id="aGvhdCI">-</div>
                            </div>
                            <div class="outcome-item">
                                <span class="outcome-label">Chronic GVHD:</span>
                                <span id="cGvhdResult" class="outcome-value">-</span>
                                <div class="confidence-interval" id="cGvhdCI">-</div>
                            </div>
                        </div>
                    </div>

                    <div class="recommendations-card">
                        <h3>Clinical Recommendations</h3>
                        <div id="recommendations" class="recommendations-list">
                            <p>Please calculate risk scores to view recommendations.</p>
                        </div>
                    </div>
                </div>

                <!-- Survival Curves -->
                <div class="charts-section">
                    <h3>Predicted Survival Curves</h3>
                    <div class="charts-grid">
                        <div class="chart-container">
                            <canvas id="survivalChart"></canvas>
                        </div>
                        <div class="chart-container">
                            <canvas id="outcomeChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <script>
        class MDSTransplantPredictor {
            constructor() {
                this.patientData = {};
                this.riskScores = {};
                this.outcomes = {};
                this.charts = {};
                
                this.initialize();
            }

            initialize() {
                this.setupEventListeners();
                this.initializeValidation();
            }

            setupEventListeners() {
                // Calculate risk button
                document.getElementById('calculateRisk').addEventListener('click', () => {
                    this.calculateAllRiskScores();
                });

                // Compare scenarios button
                document.getElementById('compareScenarios').addEventListener('click', () => {
                    this.compareScenarios();
                });

                // Export report button
                document.getElementById('exportReport').addEventListener('click', () => {
                    this.exportReport();
                });

                // Form validation on input change
                this.setupFormValidation();
            }

            setupFormValidation() {
                const inputs = document.querySelectorAll('input, select');
                inputs.forEach(input => {
                    input.addEventListener('change', () => {
                        this.validateInput(input);
                        this.updatePatientData();
                    });
                });
            }

            validateInput(input) {
                const value = input.value;
                const id = input.id;
                
                // Remove existing validation classes
                input.classList.remove('valid', 'invalid');
                
                // Basic validation
                if (input.required && !value) {
                    input.classList.add('invalid');
                    return false;
                }
                
                // Specific validations
                switch (id) {
                    case 'patientAge':
                        if (value < 18 || value > 80) {
                            this.showValidationMessage(input, 'Age should be between 18-80 years');
                            input.classList.add('invalid');
                            return false;
                        }
                        break;
                    case 'blastPercentage':
                        if (value < 0 || value > 30) {
                            this.showValidationMessage(input, 'Blast percentage should be 0-30% for MDS');
                            input.classList.add('invalid');
                            return false;
                        }
                        break;
                    case 'hemoglobin':
                        if (value < 4 || value > 18) {
                            this.showValidationMessage(input, 'Hemoglobin should be 4-18 g/dL');
                            input.classList.add('invalid');
                            return false;
                        }
                        break;
                }
                
                input.classList.add('valid');
                return true;
            }

            showValidationMessage(input, message) {
                // Remove existing message
                const existingMessage = input.parentNode.querySelector('.validation-message');
                if (existingMessage) {
                    existingMessage.remove();
                }
                
                // Add new message
                const messageElement = document.createElement('div');
                messageElement.className = 'validation-message';
                messageElement.textContent = message;
                input
